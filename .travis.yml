language: java
jdk:
- oraclejdk8
- oraclejdk9
env:
  matrix:
  - COVERAGE=0.05 BUILD_TARGET=./monolithic/ui
  - COVERAGE=0.14 BUILD_TARGET=./monolithic/service/cart
  - COVERAGE=0.0 BUILD_TARGET=./monolithic/service/user
  - COVERAGE=0.36 BUILD_TARGET=./monolithic/repository/order
  - COVERAGE=0.0 BUILD_TARGET=./monolithic/repository/cart
  - COVERAGE=0.12 BUILD_TARGET=./monolithic/repository/product
  - COVERAGE=0.31 BUILD_TARGET=./monolithic/repository/user
  global:
  - DOCKER_LOGIN=wenlock
  - secure: FPECfjPaeyL1h7YkrgmEB3pg0hjdd+11BxCMtu3t6ITLpyawdCp9PWBmV7aswpgGiL7uxsRLfYmmgJJKJIac1IKWbu8SPsDH+efy4CerCCKoKRors5eMuc3d2+jKsFtF93DVjrKCWzNPPDWxLFT96Kliio6uXX3OQCYGqBp/bWyA1xbqBijURR49EvdlqMye1xH3KW2U+kE5s8YZerfcxRWFjtaEIzrtgo+ShbRkaaUHfjTGHcw+tJgL0chruocetS8aDN4Q6VJD6E2Mq7+kZlqykjbhQeqS7yECFC9qwP8JLwU1NCzACVvxRQoJP6TrOckOSPNH4HSt0R9zrcm2izlUU92RpKkMhqi9/vj/PB2QuxLDGssWoH2J+ixFz+jUEJ6jf/tNKyzPj9Jta8ZQjtr2K6LEY8/8LMr8EpB/g4+ogJ3kj8Lm5vBGjU2nVOJCYfG/aaNCz+Ah1C/SMgWRVhgm9nE5dr2mnwIIULVNxJP+uFbEQ4S88/hisu+imR9k33z/hhhXrBFBmwGeZEQs0sFTpW4J9Z9iYm0QyjvYw82NLN8YYbXacyhilXkypxFHdgwzw/nJ/Zl5WohmR6Zz1bU/SRhQoAOq18WIxFTfWZ1XaSjq3WdqGWe1lZ+xeB/+DUqX6ShBb30FUpfC5c6hk8pH5kt/WIHO20uCSQcBPCg=
install:
- "./gradlew clean jar"
script:
- "./gradlew -p $BUILD_TARGET check"
after_success:
- find . -name jacocoTestReport.csv|xargs cat|awk -F',' '{print $3" "$4" "$5}'
- echo "Build succedded for $BUILD_TARGET"
before_deploy:
- "./gradlew -p ./monolithic/ui packageToContainer ;"
- echo "Build target is --> $BUILD_TARGET"
deploy:
  provider: script
  script: ./script/deploy.sh
  on:
    condition: "$BUILD_TARGET == './monolithic/ui'"
    all_branches: true
